# uwsgi配置文件 - 适合宝塔面板部署
# 配置说明：https://uwsgi-docs.readthedocs.io/en/latest/

[uwsgi]
# ==============================
# 核心配置
# ==============================

# 项目目录（根据实际项目路径修改）
chdir = /www/wwwroot/answer

# Django项目的WSGI入口
module = wechat_survey.wsgi:application

# Python虚拟环境路径（根据实际虚拟环境路径修改）
home = /www/server/pyporject_evn/.venv

# 主进程
master = true

# 工作进程数量（建议根据CPU核心数调整，一般为CPU核心数*2+1）
workers = 4

# 每个工作进程的线程数
threads = 2

# ==============================
# 网络配置
# ==============================

# 使用socket通信（与nginx配合）
socket = 127.0.0.1:8001

# 或使用HTTP通信（直接访问，不建议生产环境使用）
# http = 0.0.0.0:8001

# ==============================
# 静态文件配置
# ==============================

# 静态文件映射（由uwsgi处理，或由nginx直接处理）
# static-map = /static=/www/wwwroot/wechat_survey/staticfiles
# static-map = /media=/www/wwwroot/wechat_survey/media

# ==============================
# 权限和清理配置
# ==============================

# 设置socket权限（仅unix socket需要）
chmod-socket = 666

# 退出时清理临时文件
vacuum = true

# 自动移除unix socket文件（仅unix socket需要）
# die-on-term = true

# ==============================
# 日志配置
# ==============================

# 日志文件路径
logto = /www/wwwlogs/wechat_survey_uwsgi.log

# 日志格式
socket-log = true
logdate = true

# ==============================
# 环境变量配置
# ==============================

# 设置Django配置文件
env = DJANGO_SETTINGS_MODULE=wechat_survey.production_settings

# 禁用Python字节码编译（可选）
disable-logging = false

# ==============================
# 性能优化配置
# ==============================

# 缓冲区大小
buffer-size = 65536

# 超时时间（秒）
harakiri = 60

# 每个工作进程最大请求数（防止内存泄漏）
max-requests = 5000

# 工作进程重启间隔（平滑重启）
max-requests-delta = 30

# 启用线程锁
enable-threads = true

# 允许在主进程中加载应用
lazy-apps = true

# 禁用请求体大小限制
limit-post = 0
