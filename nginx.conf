# 微信问卷系统 Nginx 配置文件
# 用于在生产环境中处理静态文件和反向代理到 uWSGI

server {
    # 监听端口
    listen 80;
    # 监听HTTPS端口（如果配置了SSL）
    # listen 443 ssl http2;
    
    # 域名配置 - 请替换为实际的域名
    server_name your-domain.com www.your-domain.com;
    
    # 访问日志配置
    access_log /var/log/nginx/wechat_survey_access.log;
    error_log /var/log/nginx/wechat_survey_error.log;
    
    # SSL配置（如果需要）
    # ssl_certificate /path/to/your/ssl/certificate.crt;
    # ssl_certificate_key /path/to/your/ssl/private.key;
    # ssl_protocols TLSv1.2 TLSv1.3;
    # ssl_ciphers HIGH:!aNULL:!MD5;
    
    # 静态文件配置
    location /static/ {
        # 静态文件路径 - 请替换为实际的静态文件路径
        alias /path/to/your/project/anwser/staticfiles/;
        
        # 缓存配置
        expires 30d;
        add_header Cache-Control "public, max-age=2592000";
        
        # 访问控制
        autoindex off;
        
        # 压缩配置
        gzip on;
        gzip_types text/css text/javascript application/javascript image/svg+xml;
    }
    
    # 媒体文件配置（如果需要上传文件）
    location /media/ {
        # 媒体文件路径 - 请替换为实际的媒体文件路径
        alias /path/to/your/project/anwser/media/;
        
        # 缓存配置
        expires 7d;
        add_header Cache-Control "public, max-age=604800";
        
        # 访问控制
        autoindex off;
    }
    
    # 健康检查（可选）
    location /health {
        access_log off;
        return 200 "OK";
        add_header Content-Type text/plain;
    }
    
    # 主应用反向代理配置
    location / {
        # 传递给 uWSGI 服务器
        include uwsgi_params;
        
        # uWSGI 服务器地址 - 与 uwsgi.ini 中的 socket 配置保持一致
        uwsgi_pass 127.0.0.1:8001;
        
        # uWSGI 额外参数
        uwsgi_param Host $host;
        uwsgi_param X-Real-IP $remote_addr;
        uwsgi_param X-Forwarded-For $proxy_add_x_forwarded_for;
        uwsgi_param X-Forwarded-Proto $scheme;
        
        # 超时设置
        uwsgi_read_timeout 300;
        uwsgi_send_timeout 300;
        proxy_connect_timeout 300;
        proxy_read_timeout 300;
        proxy_send_timeout 300;
    }
    
    # 重定向配置（可选）
    # 将 HTTP 重定向到 HTTPS（如果配置了SSL）
    # if ($scheme != "https") {
    #     return 301 https://$host$request_uri;
    # }
}
