[uwsgi]
# ==============================
# Django项目配置
# ==============================
# 指定Django应用的WSGI入口模块
module = wechat_survey.wsgi:application
# 指定Django项目目录
django-project-dir = /app

# ==============================
# 进程和线程配置
# ==============================
# 启用主进程模式
master = true
# 设置4个工作进程
workers = 4
# 每个工作进程使用2个线程
threads = 2

# ==============================
# 套接字配置
# ==============================
# 注释掉的unix socket配置，适用于nginx和uwsgi在同一主机的情况
# socket = /tmp/wechat_survey.sock

# TCP socket配置，适用于容器化部署，便于容器间通信
# 监听所有网络接口的8000端口
# 用于nginx反向代理连接
# socket = 0.0.0.0:8000
http = 0.0.0.0:8000

# ==============================
# 权限和清理配置
# ==============================
# 设置socket文件的权限（仅unix socket需要）
chmod-socket = 666
# 退出时清理临时文件和socket文件
vacuum = true

# ==============================
# 日志配置
# ==============================
# 不禁用日志
disable-logging = false
# 指定日志文件路径
logto = /var/log/uwsgi/wechat_survey.log
# 在日志中显示日期和时间
logdate = true

# ==============================
# 静态文件配置
# ==============================
# 注释掉的静态文件映射配置，如果由uwsgi处理静态文件
# static-map = /static=/app/static
# 建议：生产环境由nginx处理静态文件，性能更好

# ==============================
# 环境变量配置
# ==============================
# 指定Django设置模块
env = DJANGO_SETTINGS_MODULE=wechat_survey.production_settings

# ==============================
# 其他配置
# ==============================
# 设置请求缓冲区大小为32KB
buffer-size = 32768
# 设置harakiri超时时间为60秒，超过时间的请求会被终止
harakiri = 60
# 启用harakiri超时的详细日志
harakiri-verbose = true
# 每个工作进程处理5000个请求后自动重启，防止内存泄漏
max-requests = 5000
# 工作进程重启的请求数差，用于平滑重启
max-requests-delta = 30

# ==============================
# 开发环境配置（生产环境注释掉）
# ==============================
# 当代码修改时自动重载uwsgi（仅用于开发环境）
# py-autoreload = 1